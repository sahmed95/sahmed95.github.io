


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>qutip.control.stats &mdash; QuTiP 4.1 Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="QuTiP 4.1 Documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> QuTiP: Quantum Toolbox in Python
          

          
          </a>

          
            
            
              <div class="version">
                4.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../frontmatter.html">Frontmatter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide/guide.html">Users Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apidoc/apidoc.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributors.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../biblio.html">Bibliography</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">QuTiP: Quantum Toolbox in Python</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>qutip.control.stats</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for qutip.control.stats</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># This file is part of QuTiP: Quantum Toolbox in Python.</span>
<span class="c1">#</span>
<span class="c1">#    Copyright (c) 2014 and later, Alexander J G Pitchford</span>
<span class="c1">#    All rights reserved.</span>
<span class="c1">#</span>
<span class="c1">#    Redistribution and use in source and binary forms, with or without</span>
<span class="c1">#    modification, are permitted provided that the following conditions are</span>
<span class="c1">#    met:</span>
<span class="c1">#</span>
<span class="c1">#    1. Redistributions of source code must retain the above copyright notice,</span>
<span class="c1">#       this list of conditions and the following disclaimer.</span>
<span class="c1">#</span>
<span class="c1">#    2. Redistributions in binary form must reproduce the above copyright</span>
<span class="c1">#       notice, this list of conditions and the following disclaimer in the</span>
<span class="c1">#       documentation and/or other materials provided with the distribution.</span>
<span class="c1">#</span>
<span class="c1">#    3. Neither the name of the QuTiP: Quantum Toolbox in Python nor the names</span>
<span class="c1">#       of its contributors may be used to endorse or promote products derived</span>
<span class="c1">#       from this software without specific prior written permission.</span>
<span class="c1">#</span>
<span class="c1">#    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span class="c1">#    &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="c1">#    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A</span>
<span class="c1">#    PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<span class="c1">#    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<span class="c1">#    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<span class="c1">#    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<span class="c1">#    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<span class="c1">#    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<span class="c1">#    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="c1">#    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="c1">###############################################################################</span>

<span class="c1"># @author: Alexander Pitchford</span>
<span class="c1"># @email1: agp1@aber.ac.uk</span>
<span class="c1"># @email2: alex.pitchford@gmail.com</span>
<span class="c1"># @organization: Aberystwyth University</span>
<span class="c1"># @supervisor: Daniel Burgarth</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Statistics for the optimisation</span>
<span class="sd">Note that some of the stats here are redundant copies from the optimiser</span>
<span class="sd">used here for calculations</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">datetime</span>


<div class="viewcode-block" id="Stats"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.stats.Stats">[docs]</a><span class="k">class</span> <span class="nc">Stats</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all optimisation statistics</span>
<span class="sd">    Used for configurations where all timeslots are updated each iteration</span>
<span class="sd">    e.g. exact gradients</span>
<span class="sd">    Note that all times are generated using timeit.default_timer() and are</span>
<span class="sd">    in seconds</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    dyn_gen_name : string</span>
<span class="sd">        Text used in some report functions.</span>
<span class="sd">        Makes sense to set it to &#39;Hamiltonian&#39; when using unitary dynamics</span>
<span class="sd">        Default is simply &#39;dynamics generator&#39;</span>

<span class="sd">    num_iter : integer</span>
<span class="sd">        Number of iterations of the optimisation algorithm</span>

<span class="sd">    wall_time_optim_start : float</span>
<span class="sd">        Start time for the optimisation</span>

<span class="sd">    wall_time_optim_end : float</span>
<span class="sd">        End time for the optimisation</span>

<span class="sd">    wall_time_optim : float</span>
<span class="sd">        Time elasped during the optimisation</span>

<span class="sd">    wall_time_dyn_gen_compute : float</span>
<span class="sd">        Total wall (elasped) time computing combined dynamics generator</span>
<span class="sd">        (for example combining drift and control Hamiltonians)</span>

<span class="sd">    wall_time_prop_compute : float</span>
<span class="sd">        Total wall (elasped) time computing propagators, that is the</span>
<span class="sd">        time evolution from one timeslot to the next</span>
<span class="sd">        Includes calculating the propagator gradient for exact gradients</span>

<span class="sd">    wall_time_fwd_prop_compute : float</span>
<span class="sd">        Total wall (elasped) time computing combined forward propagation,</span>
<span class="sd">        that is the time evolution from the start to a specific timeslot.</span>
<span class="sd">        Excludes calculating the propagators themselves</span>

<span class="sd">    wall_time_onwd_prop_compute : float</span>
<span class="sd">        Total wall (elasped) time computing combined onward propagation,</span>
<span class="sd">        that is the time evolution from a specific timeslot to the end time.</span>
<span class="sd">        Excludes calculating the propagators themselves</span>

<span class="sd">    wall_time_gradient_compute : float</span>
<span class="sd">        Total wall (elasped) time computing the fidelity error gradient.</span>
<span class="sd">        Excludes calculating the propagator gradients (in exact gradient</span>
<span class="sd">        methods)</span>

<span class="sd">    num_fidelity_func_calls : integer</span>
<span class="sd">        Number of calls to fidelity function by the optimisation algorithm</span>

<span class="sd">    num_grad_func_calls : integer</span>
<span class="sd">        Number of calls to gradient function by the optimisation algorithm</span>

<span class="sd">    num_tslot_recompute : integer</span>
<span class="sd">        Number of time the timeslot evolution is recomputed</span>
<span class="sd">        (It is only computed if any amplitudes changed since the last call)</span>

<span class="sd">    num_fidelity_computes : integer</span>
<span class="sd">        Number of time the fidelity is computed</span>
<span class="sd">        (It is only computed if any amplitudes changed since the last call)</span>

<span class="sd">    num_grad_computes : integer</span>
<span class="sd">        Number of time the gradient is computed</span>
<span class="sd">        (It is only computed if any amplitudes changed since the last call)</span>

<span class="sd">    num_ctrl_amp_updates : integer</span>
<span class="sd">        Number of times the control amplitudes are updated</span>

<span class="sd">    mean_num_ctrl_amp_updates_per_iter : float</span>
<span class="sd">        Mean number of control amplitude updates per iteration</span>

<span class="sd">    num_timeslot_changes : integer</span>
<span class="sd">        Number of times the amplitudes of a any control in a timeslot changes</span>

<span class="sd">    mean_num_timeslot_changes_per_update : float</span>
<span class="sd">        Mean average number of timeslot amplitudes that are changed per update</span>

<span class="sd">    num_ctrl_amp_changes : integer</span>
<span class="sd">        Number of times individual control amplitudes that are changed</span>

<span class="sd">    mean_num_ctrl_amp_changes_per_update : float</span>
<span class="sd">        Mean average number of control amplitudes that are changed per update</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dyn_gen_name</span> <span class="o">=</span> <span class="s2">&quot;dynamics generator&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_iter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Duration attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wall_time_optim_start</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wall_time_optim_end</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wall_time_optim</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wall_time_dyn_gen_compute</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wall_time_prop_compute</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wall_time_fwd_prop_compute</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wall_time_onwd_prop_compute</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wall_time_gradient_compute</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1"># Fidelity and gradient function calls and computes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_fidelity_func_calls</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_grad_func_calls</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_tslot_recompute</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_fidelity_computes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_grad_computes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Control amplitudes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_ctrl_amp_updates</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_ctrl_amp_updates_per_iter</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_timeslot_changes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_timeslot_changes_per_update</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_ctrl_amp_changes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_ctrl_amp_changes_per_update</span> <span class="o">=</span> <span class="mf">0.0</span>

<div class="viewcode-block" id="Stats.calculate"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.stats.Stats.calculate">[docs]</a>    <span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform the calculations (e.g. averages) that are required on the stats</span>
<span class="sd">        Should be called before calling report</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the optimation is still running then the optimisation</span>
        <span class="c1"># time is the time so far</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wall_time_optim_end</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_time_optim</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">wall_time_optim_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wall_time_optim_start</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_ctrl_amp_updates_per_iter</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">num_ctrl_amp_updates</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_iter</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_ctrl_amp_updates_per_iter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_timeslot_changes_per_update</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">num_timeslot_changes</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_ctrl_amp_updates</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_timeslot_changes_per_update</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_ctrl_amp_changes_per_update</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">num_ctrl_amp_changes</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_ctrl_amp_updates</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_ctrl_amp_changes_per_update</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span></div>

    <span class="k">def</span> <span class="nf">_format_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">tot</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="n">dtStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">t</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">tot</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">percent</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="n">tot</span>
            <span class="n">dtStr</span> <span class="o">+=</span> <span class="s2">&quot; (</span><span class="si">{:03.2f}</span><span class="s2">%)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">percent</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dtStr</span>

<div class="viewcode-block" id="Stats.report"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.stats.Stats.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print a report of the stats to the console</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">------------------------------------&quot;</span>
              <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">---- Control optimisation stats ----&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_timings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_func_calls</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_amp_updates</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------------------&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">report_timings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**** Timings (HH:MM:SS.US) ****&quot;</span><span class="p">)</span>
        <span class="n">tot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wall_time_optim</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total wall time elapsed during optimisation: &quot;</span> <span class="o">+</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">_format_datetime</span><span class="p">(</span><span class="n">tot</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wall time computing Hamiltonians: &quot;</span> <span class="o">+</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">_format_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_time_dyn_gen_compute</span><span class="p">,</span> <span class="n">tot</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wall time computing propagators: &quot;</span> <span class="o">+</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">_format_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_time_prop_compute</span><span class="p">,</span> <span class="n">tot</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wall time computing forward propagation: &quot;</span> <span class="o">+</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">_format_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_time_fwd_prop_compute</span><span class="p">,</span> <span class="n">tot</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wall time computing onward propagation: &quot;</span> <span class="o">+</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">_format_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_time_onwd_prop_compute</span><span class="p">,</span> <span class="n">tot</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wall time computing gradient: &quot;</span> <span class="o">+</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">_format_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_time_gradient_compute</span><span class="p">,</span> <span class="n">tot</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">report_func_calls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**** Iterations and function calls ****&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of iterations: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_iter</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of fidelity function calls: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_fidelity_func_calls</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of times fidelity is computed: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_fidelity_computes</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of gradient function calls: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_grad_func_calls</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of times gradients are computed: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_grad_computes</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of times timeslot evolution is recomputed: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslot_recompute</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">report_amp_updates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**** Control amplitudes ****&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of control amplitude updates: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_ctrl_amp_updates</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean number of updates per iteration: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_num_ctrl_amp_updates_per_iter</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of timeslot values changed: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_timeslot_changes</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean number of timeslot changes per update: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_num_timeslot_changes_per_update</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of amplitude values changed: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_ctrl_amp_changes</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean number of amplitude changes per update: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_num_ctrl_amp_changes_per_update</span><span class="p">))</span></div>


<span class="k">class</span> <span class="nc">StatsDynTsUpdate</span><span class="p">(</span><span class="n">Stats</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Optimisation stats class for configurations where all timeslots are not</span>
<span class="sd">    necessarily updated at each iteration. In this case it may be interesting</span>
<span class="sd">    to know how many Hamiltions etc are computed each ctrl amplitude update</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    num_dyn_gen_computes : integer</span>
<span class="sd">        Total number of dynamics generator (Hamiltonian) computations,</span>
<span class="sd">        that is combining drift and control dynamics to calculate the</span>
<span class="sd">        combined dynamics generator for the timeslot</span>

<span class="sd">    mean_num_dyn_gen_computes_per_update : float</span>
<span class="sd">        # Mean average number of dynamics generator computations per update</span>

<span class="sd">    mean_wall_time_dyn_gen_compute : float</span>
<span class="sd">        # Mean average time to compute a timeslot dynamics generator</span>

<span class="sd">    num_prop_computes : integer</span>
<span class="sd">        Total number of propagator (and propagator gradient for exact</span>
<span class="sd">        gradient types) computations</span>

<span class="sd">    mean_num_prop_computes_per_update : float</span>
<span class="sd">        Mean average number of propagator computations per update</span>

<span class="sd">    mean_wall_time_prop_compute : float</span>
<span class="sd">        Mean average time to compute a propagator (and its gradient)</span>

<span class="sd">    num_fwd_prop_step_computes : integer</span>
<span class="sd">        Total number of steps (matrix product) computing forward propagation</span>

<span class="sd">    mean_num_fwd_prop_step_computes_per_update : float</span>
<span class="sd">        Mean average number of steps computing forward propagation</span>

<span class="sd">    mean_wall_time_fwd_prop_compute : float</span>
<span class="sd">        Mean average time to compute forward propagation</span>

<span class="sd">    num_onwd_prop_step_computes : integer</span>
<span class="sd">        Total number of steps (matrix product) computing onward propagation</span>

<span class="sd">    mean_num_onwd_prop_step_computes_per_update : float</span>
<span class="sd">        Mean average number of steps computing onward propagation</span>

<span class="sd">    mean_wall_time_onwd_prop_compute</span>
<span class="sd">        Mean average time to compute onward propagation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Stats</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Dynamics generators (Hamiltonians)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_dyn_gen_computes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_dyn_gen_computes_per_update</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_wall_time_dyn_gen_compute</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1"># **** Propagators *****</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_prop_computes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_prop_computes_per_update</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_wall_time_prop_compute</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1"># **** Forward propagation ****</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_fwd_prop_step_computes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_fwd_prop_step_computes_per_update</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_wall_time_fwd_prop_compute</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1"># **** onward propagation ****</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_onwd_prop_step_computes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_onwd_prop_step_computes_per_update</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_wall_time_onwd_prop_compute</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Stats</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_dyn_gen_computes_per_update</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">num_dyn_gen_computes</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_ctrl_amp_updates</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mean_wall_time_dyn_gen_compute</span> <span class="o">=</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_time_dyn_gen_compute</span> <span class="o">/</span>
             <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_dyn_gen_computes</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_prop_computes_per_update</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">num_prop_computes</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_ctrl_amp_updates</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mean_wall_time_prop_compute</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_time_prop_compute</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_prop_computes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_fwd_prop_step_computes_per_update</span> <span class="o">=</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_fwd_prop_step_computes</span> <span class="o">/</span>
             <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_ctrl_amp_updates</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mean_wall_time_fwd_prop_compute</span> <span class="o">=</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_time_fwd_prop_compute</span> <span class="o">/</span>
             <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_fwd_prop_step_computes</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_onwd_prop_step_computes_per_update</span> <span class="o">=</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_onwd_prop_step_computes</span> <span class="o">/</span>
             <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_ctrl_amp_updates</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mean_wall_time_onwd_prop_compute</span> <span class="o">=</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_time_onwd_prop_compute</span> <span class="o">/</span>
             <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_onwd_prop_step_computes</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print a report of the stats to the console</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">------------------------------------&quot;</span>
              <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">---- Control optimisation stats ----&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_timings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_func_calls</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_amp_updates</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dyn_gen_comps</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_fwd_prop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_onwd_prop</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------------------&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">report_dyn_gen_comps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**** </span><span class="si">{}</span><span class="s2"> Computations ****&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dyn_gen_name</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total number of </span><span class="si">{}</span><span class="s2"> computations: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dyn_gen_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_dyn_gen_computes</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean number of </span><span class="si">{}</span><span class="s2"> computations per update: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dyn_gen_name</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">mean_num_dyn_gen_computes_per_update</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean wall time to compute </span><span class="si">{}</span><span class="s2">s: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dyn_gen_name</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mean_wall_time_dyn_gen_compute</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**** Propagator Computations ****&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total number of propagator computations: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_prop_computes</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean number of propagator computations per update: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_num_prop_computes_per_update</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean wall time to compute propagator &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_wall_time_prop_compute</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">report_fwd_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**** Forward Propagation ****&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total number of forward propagation step computations: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_fwd_prop_step_computes</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean number of forward propagation step computations&quot;</span>
              <span class="s2">&quot; per update: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_num_fwd_prop_step_computes_per_update</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean wall time to compute forward propagation &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_wall_time_fwd_prop_compute</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">report_onwd_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**** Onward Propagation ****&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total number of onward propagation step computations: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_onwd_prop_step_computes</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean number of onward propagation step computations&quot;</span>
              <span class="s2">&quot; per update: &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_num_onwd_prop_step_computes_per_update</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean wall time to compute onward propagation &quot;</span>
              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_wall_time_onwd_prop_compute</span><span class="p">))</span>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2011 and later, P.D. Nation, J.R. Johansson, A.J.G. Pitchford, C. Granade, and A.L. Grimsmo.
      Last updated on Jul 14, 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'4.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>